!function(){"use strict";angular.module("alt.koopon.mensagens-contador-empresa",["ngResource","alt.passaporte-usuario-logado","alt.modal-service","alt.carregando-info"]).provider("ALT_KOOPON_URL_BASE_API_MENSAGEM",[function(){this.urlBase="/koopon-rest-api/",this.$get=function(){return this.urlBase}}]).constant("ID_MODAL_MENSAGEM","#modal-nova-mensagem").constant("EVENTO_NOVO_ASSUNTO","mensagem:novo-assunto").factory("AltKooponMensagemResource",["$resource","ALT_KOOPON_URL_BASE_API_MENSAGEM",function(n,e){var o=e+"mensagens/:id/:clientes/:idEmpresa",t={id:"@id"},s={assuntoLido:{method:"PUT",isArray:!1},enviar:{method:"POST",isArray:!1},enviarParaEmpresa:{method:"POST",isArray:!1,params:{clientes:"clientes"}},listarAssuntos:{method:"GET",isArray:!0},listarEmpresasAssuntos:{method:"GET",isArray:!1},listarMensagens:{method:"GET",isArray:!0},listarMensagensParaEmpresa:{method:"GET",isArray:!0,params:{clientes:"clientes"}}};return n(o,t,s)}]).factory("AltKooponMensagemModel",["AltPassaporteUsuarioLogadoManager",function(n){var e=function(n){this.assunto=void 0,this.texto=void 0,this.nomeUsuarioPassaporte=void 0,this.data=void 0,this.anexo=void 0,angular.extend(this,n)};return e.prototype.isValid=function(){var n=angular.isDefined(this.assunto)&&!!this.assunto.length,e=angular.isDefined(this.texto)&&!!this.texto.length;return n&&e},e.prototype.msgDoUsuarioLogado=function(){return this.nomeUsuarioPassaporte===n.retorna().nomeUsuario},e.respostaValida=function(n){return angular.isDefined(n)&&angular.isDefined(n.texto)&&!!n.texto.length},e}]).factory("AltKooponMensagemService",["$q","AltPassaporteUsuarioLogadoManager","AltKooponMensagemResource","AltKooponMensagemModel",function(n,e,o,t){var s=function(){};return s.prototype.listarAssuntos=function(){return o.listarAssuntos().$promise.then(function(n){return n.map(function(n){return new t(n)})})["catch"](function(e){return n.reject(e)})},s.prototype.listarEmpresasAssuntos=function(){return o.listarEmpresasAssuntos().$promise.then(function(n){var o=[],t=e.retorna().assinantesEmpresa;for(var s in n)t.forEach(function(e){e.id==s&&o.push({id:s,nome:e.nome,assuntos:n[s]})});return o})["catch"](function(e){return n.reject(e)})},s.prototype.listarMensagens=function(e,s){var a="listarMensagens",r={id:e};return angular.isDefined(s)&&(a="listarMensagensParaEmpresa",r={id:e,idEmpresa:s}),o[a](r).$promise.then(function(n){return n.map(function(n){return new t(n)})})["catch"](function(e){return n.reject(e)})},s.prototype.enviar=function(e,s,a){var r="enviar",i={id:s};return angular.isDefined(a)&&(r="enviarParaEmpresa",i={id:s,idEmpresa:a}),o[r](i,e).$promise.then(function(n){return new t(n)})["catch"](function(e){return n.reject(e)})},s.prototype.assuntoLido=function(e){return o.assuntoLido({id:e}).$promise.then(function(){})["catch"](function(e){return n.reject(e)})},new s}]).controller("AltKooponMensagensController",["$scope","AltKooponMensagemModel","AltKooponMensagemService","AltCarregandoInfoService","EVENTO_NOVO_ASSUNTO",function(n,e,o,t,s){var a=this;a.novaMensagem=!1,a.AltKooponMensagemModel=e,a.mensagem=new e,a.assuntos=[],a.responder=function(n,e){o.enviar(n,e).then(function(n){a.assuntos.forEach(function(o){return o.idMensagem===e?(a.mensagem="",o.mensagens.push(n)):void 0})})["catch"](function(n){})},a.listarMensagens=function(n){o.listarMensagens(n).then(function(e){return a.assuntos.forEach(function(o){return o.idMensagem===n?o.mensagens=e:void 0}),o.assuntoLido(n)})["catch"](function(n){})},function(){t.exibe(),o.listarAssuntos().then(function(n){a.assuntos=n})["catch"](function(n){})["finally"](function(){t.esconde()}),n.$on(s,function(n,e){a.assuntos.push(e)})}()}]).controller("AltKooponEmpresasComMensagensController",["$scope","AltKooponMensagemModel","AltKooponMensagemService","AltCarregandoInfoService","EVENTO_NOVO_ASSUNTO",function(n,e,o,t,s){var a=this;a.AltKooponMensagemModel=e,a.empresas=[],a.listarMensagens=function(n,e){o.listarMensagens(e,n).then(function(o){a.empresas.forEach(function(t){t.id===n&&t.assuntos.forEach(function(n){return n.idMensagem===e?n.mensagens=o:void 0})})})["catch"](function(){})},a.responder=function(n,e,t){o.enviar(n,t,e).then(function(n){a.empresas.forEach(function(o){o.id===e&&o.assuntos.forEach(function(e){return e.idMensagem===t?e.mensagens.push(n):void 0})})})["catch"](function(){})},function(){t.exibe(),o.listarEmpresasAssuntos().then(function(n){a.empresas=n})["catch"](function(n){})["finally"](function(){t.esconde()}),n.$on(s,function(n,e){a.empresas.forEach(function(n){return n.id==e.empresaEscolhida?n.assuntos.push(e):void 0})})}()}]).controller("AltKooponNovaMensagemController",["$scope","AltKooponMensagemModel","AltKooponMensagemService","AltModalService","AltPassaporteUsuarioLogadoManager","ID_MODAL_MENSAGEM","EVENTO_NOVO_ASSUNTO",function(n,e,o,t,s,a,r){var i=this;i.mensagem=new e,i.clientes=s.retorna().assinantesEmpresa,i.enviar=function(s,u){o.enviar(s,void 0,u).then(function(o){angular.extend(o,s),i.mensagem=new e,n.$emit(r,o),t.close(a)})["catch"](function(n){})}}]).directive("altKooponMensagemToggle",[function(){return function(n,e,o){var t=void 0,s=void 0;e.find(".assunto-mensagem").on("click",function(){return t=angular.element(".mensagens-container"),s=e.find(".mensagens-container"),s.is(":visible")?void s.slideUp("fast"):(t.slideUp("fast"),void s.slideDown("fast"))})}}]).directive("altKooponMensagemActive",[function(){return function(n,e,o){e.on("click",function(){return e.hasClass("active")?void e.removeClass("active"):($("[alt-koopon-mensagem-active]").removeClass("active"),void e.addClass("active"))})}}])}();