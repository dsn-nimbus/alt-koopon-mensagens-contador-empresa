!function(){"use strict";angular.module("alt.koopon.mensagens-contador-empresa",["ngResource","alt.passaporte-usuario-logado","alt.modal-service"]).provider("ALT_KOOPON_URL_BASE_API_MENSAGEM",[function(){this.urlBase="/koopon-rest-api/",this.$get=function(){return this.urlBase}}]).constant("ID_MODAL_MENSAGEM","#modal-nova-mensagem").constant("EVENTO_NOVO_ASSUNTO","mensagem:novo-assunto").factory("AltKooponMensagemResource",["$resource","ALT_KOOPON_URL_BASE_API_MENSAGEM",function(n,o){var e=o+"mensagens/:id",t={id:"@id"},s={assuntoLido:{method:"PUT",isArray:!1},enviar:{method:"POST",isArray:!1},listarAssuntos:{method:"GET",isArray:!0},listarMensagens:{method:"GET",isArray:!0}};return n(e,t,s)}]).factory("AltKooponMensagemModel",["AltPassaporteUsuarioLogadoManager",function(n){var o=function(n){this.assunto=void 0,this.texto=void 0,this.nomeUsuarioPassaporte=void 0,this.data=void 0,this.anexo=void 0,angular.extend(this,n)};return o.prototype.isValid=function(){var n=angular.isDefined(this.assunto)&&!!this.assunto.length,o=angular.isDefined(this.texto)&&!!this.texto.length;return n&&o},o.prototype.msgDoUsuarioLogado=function(){return this.nomeUsuarioPassaporte===n.retorna().nomeUsuario},o}]).factory("AltKooponMensagemService",["$q","AltKooponMensagemResource","AltKooponMensagemModel",function(n,o,e){var t=function(){};return t.prototype.listarAssuntos=function(){return o.listarAssuntos().$promise.then(function(n){return n.map(function(n){return new e(n)})})["catch"](function(o){return n.reject(o)})},t.prototype.listarMensagens=function(t){return o.listarMensagens({id:t}).$promise.then(function(n){return n.map(function(n){return new e(n)})})["catch"](function(o){return n.reject(o)})},t.prototype.enviar=function(t,s){return o.enviar({id:s},t).$promise.then(function(n){return new e(n)})["catch"](function(o){return n.reject(o)})},t.prototype.assuntoLido=function(e){return o.assuntoLido({id:e}).$promise.then(function(){})["catch"](function(o){return n.reject(o)})},new t}]).controller("AltKooponMensagensController",["$scope","AltKooponMensagemModel","AltKooponMensagemService","EVENTO_NOVO_ASSUNTO",function(n,o,e,t){var s=this;s.novaMensagem=!1,s.mensagem=new o,s.assuntos=[],s.responder=function(n,o){e.enviar(n,o).then(function(n){s.assuntos.forEach(function(e){e.idMensagem===o&&e.mensagens.push(n)})})["catch"](function(n){})},s.listarMensagens=function(n){e.listarMensagens(n).then(function(o){return s.assuntos.forEach(function(e){return e.idMensagem===n?e.mensagens=o:void 0}),e.assuntoLido(n)})["catch"](function(n){})},function(){e.listarAssuntos().then(function(n){s.assuntos=n})["catch"](function(n){}),n.$on(t,function(n,o){s.assuntos.push(o)})}()}]).controller("AltKooponNovaMensagemController",["$scope","AltKooponMensagemModel","AltKooponMensagemService","AltModalService","AltPassaporteUsuarioLogadoManager","ID_MODAL_MENSAGEM","EVENTO_NOVO_ASSUNTO",function(n,o,e,t,s,a,r){var i=this;i.mensagem=new o,i.enviar=function(s){e.enviar(s).then(function(e){i.mensagem=new o,n.$emit(r,e),t.close(a)})["catch"](function(n){})}}]).directive("altKooponMensagemToggle",[function(){return function(n,o,e){var t=void 0;o.find(".assunto-mensagem").on("click",function(){t=angular.element(".mensagens-container"),t.slideUp("fast"),o.find(t).slideDown("fast")})}}]).directive("altKooponMensagemActive",[function(){return function(n,o,e){o.on("click",function(){$("[alt-koopon-mensagem-active]").removeClass("active"),o.addClass("active")})}}])}();